CC=gcc
CC_FLAGS=-Wall -Wextra -Iinclude

SRC_DIR=src
BUILD_DIR=build

CLIENT_SRC_DIR=$(SRC_DIR)/client
SERVER_SRC_DIR=$(SRC_DIR)/server
UTILS_SRC_DIR=$(SRC_DIR)/utils
PROCESS_SRC_DIR=$(SRC_DIR)/process

CLIENT_BUILD_DIR=$(BUILD_DIR)/client
SERVER_BUILD_DIR=$(BUILD_DIR)/server
UTILS_BUILD_DIR=$(BUILD_DIR)/utils
PROCESS_BUILD_DIR=$(BUILD_DIR)/process

CLIENT_EXE=$(CLIENT_BUILD_DIR)/client.out
SERVER_EXE=$(SERVER_BUILD_DIR)/server.out
PROCESS_EXE=$(PROCESS_BUILD_DIR)/process.out

CLIENT_SRC_FILES=$(wildcard $(CLIENT_SRC_DIR)/*.c)
PROCESS_SRC_FILES=$(wildcard $(PROCESS_SRC_DIR)/*.c)
SERVER_SRC_FILES=$(wildcard $(SERVER_SRC_DIR)/*.c)
UTILS_SRC_FILES=$(wildcard $(UTILS_SRC_DIR)/*.c)

all: $(CLIENT_EXE) $(SERVER_EXE) $(PROCESS_EXE)


$(SERVER_EXE): $(SERVER_SRC_FILES) $(UTILS_SRC_FILES) | $(SERVER_BUILD_DIR)
	$(CC) $(CC_FLAGS) $^ -o $@

$(CLIENT_EXE): $(CLIENT_SRC_FILES) $(UTILS_SRC_FILES) | $(CLIENT_BUILD_DIR)
	$(CC) $(CC_FLAGS) $^ -o $@

$(PROCESS_EXE): $(PROCESS_SRC_FILES) $(UTILS_SRC_FILES) | $(PROCESS_BUILD_DIR)
	$(CC) $(CC_FLAGS) $^ -o $@

$(CLIENT_BUILD_DIR): $(BUILD_DIR)
	mkdir -p $(CLIENT_BUILD_DIR)

$(SERVER_BUILD_DIR): $(BUILD_DIR)
	mkdir -p $(SERVER_BUILD_DIR)

$(PROCESS_BUILD_DIR): $(BUILD_DIR)
	mkdir -p $(PROCESS_BUILD_DIR)

$(BUILD_DIR):
	mkdir -p $(BUILD_DIR)

clean:
	rm -rf $(BUILD_DIR)

run_server: $(SERVER_EXE)
	./$(SERVER_EXE)

run_client: $(CLIENT_EXE)
	./$(CLIENT_EXE)